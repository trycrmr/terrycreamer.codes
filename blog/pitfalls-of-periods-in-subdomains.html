<!doctype html>
<html class="no-js" lang="en-US">

<head>
  <meta charset="utf-8">
  <title>Pitfalls of Periods in Subdomains</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="manifest" href="../site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="../css/normalize.css">
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/terry.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  <meta name="theme-color" content="#fafafa">
</head>

<body>
  <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/" aria-label="Your browser is outdated; Please upgrade your browser.">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->

  <!-- Add your site or application content here -->
  <div class="wholePage">
    <nav>
      <ul>
        <li><a href="/" aria-label="Home link">Home</a></li>
        <li><a href="/blog" aria-label="Blog link">Blog</a></li>
      </ul>
    </nav>
    <aside class="meta">
      <p>
        Date Published: September 3rd, 2019<br />
        Version History: <a href="https://github.com/trycrmr/terrycreamer.codes" target="_blank" rel="noopener" rel="noreferrer" aria-label="Link to Github repository associated with this site">Git Log </a>(Suggest an <a href="https://github.com/trycrmr/terrycreamer.codes/issues" target="_blank" rel="noopener" rel="noreferrer" aria-label="Link to Github issues associated with this site">edit</a>)<br />
        Discussion: <a href="#" target="_blank" rel="noopener" rel="noreferrer" aria-label="Link to a Twitter search with tweets referencing this blog post">Twitter</a> and <a href="#" target="_blank" rel="noopener" rel="noreferrer" aria-label="Link to the Hacker News comments for this blog post">Hacker News</a>
      </p>
    </aside>
    <article class="post">
      <h1 class="title">Pitfalls of Periods in Subdomains</h1>
      <section>
        <h2 class="subtitle">While intuitive at first, using periods in subdomains for environment hostnames can lead to some undesireable consequences</h2>
        <section class="tldr">
          TL;DR: Using periods in subdomains adds complexity to SSL/TLS certificate management and
          cannot be used more than four times
          (fourthLabel.thirdLabel.secondLabel.firstLabel.domain.top-LevelDomain). Using hyphens can
          accommodate most existing, contextual (i.e. "your company's...") naming conventions and is
          easily scalable from a SSL/TLS certificate management perspective. Any trade offs are easily
          mitigated.
        </section>
        <p>
          This summer I have been putting an online course together. As is prudent for publishing
          anything on the internet, I am double and triple checking my choices align with industry
          standards and best practices. It's a DevOps course, so it walks folks through creating several
          non-production environments with associated pipelines, automation, accoutrements, etc. . I
          want the hostnames of these environments to align as clearly as possible with how I would
          reference them verbally. In the workplace I've accomplished this partially by separating "words"
          in the hostname with periods. When the URL was sent to others, particularly non-technical folks,
          the URL would be semantic enough to clearly reflect the purpose of the environment, such as
          product.environmenttype.company.com (i.e. companywiki.testing.bigcorp.com) . This proved to
          be really helpful as some folks in the workplace were working with tens of products at a time
          (change management folks, middle managers, security professionals, etc. ). Little did I know
          using periods sets one up for significant additional complexity in managing TLS/SSL certificates
          for non-prod environments and significantly limits naming convention possibilities (gasp!). Most
          industry content around naming is the different, contextual naming conventions teams have
          come up with. I didn't come across content about translating these naming conventions into
          hostnames while avoiding traps (cue ​ Admiral Akbar gif​ ).
        </p>
        <p>
          Environment hostname naming conventions can be scaled with one SSL/TLS certificate (i.e.
          "cert") up to one 63 character subdomain, presuming the cert has a *.domain.top-levelDomain
          wildcard. Any use of periods in the subdomain will create another ​ "label" (also called a
          "fragment", example: label.domain.top-LevelDomain)​ . Each one of these labels can have up to
          63 characters, however the total of all the labels, plus the periods that separate them, plus the
          domain name, plus the top-level domain cannot exceed 255 characters. In other words,
          label4.label3.label2.label1.domain.top-LevelDomain must be less than 255. Here is an example
          of a 63 character valid label: "what-is-a-ballons-least-favorite-genre-of-music----pop-hahahaha".
          Seems like that's long enough to accommodate most company naming convention use cases to
          me, including smart speaker jokes!
        </p>
        <p>
          Any label after the first will not be covered by the SSL/TLS certificate that has a wildcard on the
          first label​ (*gasps again*!). Approached from another angle, if you want to have more than one
          label in a hostname, you need to have a SSL/TLS certificate that denotes what the first label
          should be, with a wildcard for the second label (i.e. *.labelOne.domain.top-levelDomain). The
          same is true for wildcarding the third or fourth label, each with a separate, properly "wildcarded" TLS/SSL certificate. This is where competent certificate management comes in if you want to
          scale your company's naming convention to cover multiple labels.
        </p>
        <p>
          However, I'd put forward an adequate alternative approach is to use hyphens instead of periods
          in your first label. This will allow you up to 63 characters to express the environment with the
          hostname and you can encrypt all communications over all the environments using one
          SSL/TLS certificate. Cue third gasp, standing ovation, and profits!!
        </p>
        <p>
          The number of string permutations is a large number. Something like
          371,993,326,789,901,217,467,999,448,150,835,200,000,000 according to ​ an internet
          combination calculator​ . I asked a ​ Math Stack Exchange question asking how to get this number
          and came up with 6.435878542419158e98 with some scrappy JavaScript (​ const firstLoop = 36
          /* Hypens can't begin a label */; const otherLoops = 37; const maxLabelLength = 63; let sum =
          0; for(let i=1; i<=maxLabelLength; i++) {sum += i==0 ? firstLoop ** i : otherLoops ** i }; ​ ). Either
          way, it's one of those numbers that's so big it's tough to represent. This number is effectively
          doubled as a second label is wildcarded and associated with a specific first label
          (*.specificFirstLabel.domain.top-levelDomain). Obviously, all of these naming permutations
          wouldn't be practical. I dare you to, reader, to make a list of the practical ones (lol jk, don't).
        </p>
        <p>
          The approach of using hyphens instead of periods in hostnames naming conventions of
          non-prod environments allows for:
          ...enough creative surface area for contextualized naming conventions in the subdomain...
          ...secure communications with the simplest TLS/SSL certificate management approach possible
          (i.e. only one, maybe two TLS/SSL certs to manage (two if you want to separate prod &
          non-prod TLS/SSL certificates)...
          ...is easily scalable by adding a TLS/SSL certificate for a specific first label with a "wildcarded"
          second label...
          ...and can accommodate any current naming convention that doesn't typically exceed 63
          characters.
        </p>
        <p>
          Other details worth noting:
        </p>
        <p>
          One can pay for "​ Subject Alternative Names​ ", which is a service provided by a Certificate
          Authority that basically abstracts the certificate management, making it appear as if you're able
          to use nested wildcards of labels without additional certificates. It is a way to solve this problem
          with money. With so many permutations offered within the 63-character label limit I'd posit most
          IT budgets could find better uses for the money.
        </p>
        <p>
          I suppose teams could choose to use HTTP for their non-prod environments to forego the
          certificate management altogether. Is that really a wise choice though? Besides sending visible
          web traffic and opting out of environment parity with production, all modern browsers are
          apparently only supporting HTTP/2 over SSL/TLS ​ according to this article​ (note that only Firefox
          is sourced). For web applications ​ any benefits of HTTP/2​ in non-prod environments can only betaken advantage of by serving non-prod environments over HTTPS. So sure, it's an option. Is
          managing one TLS/SSL certificate really too much to ask in lieu of all these gains? Enjoy that
          Friday deployment when you learn the hard way all your assets were referenced using HTTP
          URLs.
        </p>
        <p>
          Arguably, the hyphen is only for readability. One could forego including hyphens to save
          characters if the 63 character label limit can't accommodate some longer, hopefully edge case
          naming conventions. My guess is the semantic exchange would not be worth it though as
          figuringoutwhat63characterstringssayeverydaywouldmakemyeyescross. That's 64 characters,
          but you get the point.
        </p>
        <p>
          For brevity's sake, here's a list of some trade offs to using one SSL/TLS certificate for securing
          multiple environment hostnames:
          If the private key of your SSL/TLS certificate is compromised all HTTPS communication
          transmitted using that certificate could have been compromised and a new SSL/TLS
          certificate should be rolled out to all environments ASAP.
          ○ Mitigation: Have two separate SSL/TLS certificates for production
          (domain.top-LevelDomain & www.domain.top-LevelDomain) and non-prod
          environments (*.domain.top-LevelDomain).
          Any issues with SSL/TLS renewal will effect all environments
          ○ Mitigation: Automatically renew SSL/TLS certificates at a third of their expiration
          lifespan, at least, and confirm the certificate is renewed
        </p>
        <p>
          Hope this sheds some light on the consequences of a seemingly harmless and intuitive choice
          to use periods in subdomains! Hyphens for the win!
          Useful sources/links:
          Is there a security issue in using the same certificate for all a company's services?​ (Server Fault
          thread)
          Can You Create A Wildcard SSL Certificate For Two Levels?​ (Useful blog post with this
          illuminating quote, "The reasons it is not possible to have a "double wildcard" SSL certificate is
          that the placeholder, the asterisk, can only stand in for one field in the name submitted to the
          CA. After all, the CA has to verify all information, and too many variables in the certificate would
          decrease the security and confidence the certificate provides.")
          gitlab pages: dots in subdomain break tls, need to sanitize periods (.) to hypens (-) in pages
          subdomain​ (Relevant Gitlab Pages real-world issue)
        </p>
      </section>
      <section>
        <h2 clas="subtitle">What the others said</h2>
      </section>
    </article>
    <aside class='meta'>
      <p>Author: <a href="/" target="_blank" rel="noopener" rel="noreferrer" aria-label="Link to Terry Creamer's Website and Blog">Terry Creamer </a></p>
    </aside>
    <nav class="navSpace"> <!-- Creates a second nav for consistent spacing with mobile nav and content on mobile. Hacky approach; It gets the job done for now. -->
      <ul>
        <li><a href="/" aria-label="Home link"></a></li>
        <li><a href="/blog" aria-label="Blog link"></a></li>
      </ul>
    </nav>
  </div>

  <script src="../js/vendor/modernizr-3.7.1.min.js"></script>
  <!--   
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="js/vendor/jquery-3.3.1.min.js"><\/script>')</script>
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script> 
  -->
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>

	WebFont.load({
		custom: {
			families: ['FontAwesome'],
			urls: ['//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css']
		}
	});
</script>
  <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-31386246-6', 'auto'); ga('set','transport','beacon'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>
</body>

</html>
